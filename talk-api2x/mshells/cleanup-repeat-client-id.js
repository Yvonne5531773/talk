// Generated by CoffeeScript 1.10.0
(function() {
  var devicetokens, dtMap, removeCount, tokenMap;

  devicetokens = db.devicetokens.find().sort({
    updatedAt: -1
  });

  dtMap = {};

  tokenMap = {};

  removeCount = 0;

  devicetokens.forEach(function(dt) {
    var key;
    key = "" + dt.user + dt.type + dt.clientId;
    if (dtMap[key] || tokenMap[dt.token] || !dt.clientId) {
      print("Remove", JSON.stringify(dt));
      removeCount += 1;
      return db.devicetokens.remove({
        _id: dt._id
      });
    } else {
      dtMap[key] = dt._id;
      return tokenMap[dt.token] = dt._id;
    }
  });

  print("Removed count", removeCount);

}).call(this);
